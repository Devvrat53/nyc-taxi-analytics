{
	"name": "12_create_silver_trip_data_green",
	"properties": {
		"folder": {
			"name": "nyc_taxi/ldw"
		},
		"content": {
			"query": "-- Connect to the nyc_taxi_ldw database\nUSE nyc_taxi_ldw\nGO\n\n\n-- Create Silver layer data for the calendar by converting the bronze CSV files to silver parquet files\nIF OBJECT_ID('silver.trip_data_green') IS NOT NULL\n    DROP EXTERNAL TABLE silver.trip_data_green\nGO\n\nCREATE EXTERNAL TABLE silver.trip_data_green\n    WITH \n    (\n        DATA_SOURCE = nyc_taxi_src,\n        LOCATION = 'silver/trip_data_green',\n        FILE_FORMAT = parquet_file_format\n    )\nAS\nSELECT\n    *\nFROM\n    bronze.trip_data_green_csv;\n\nSELECT * FROM silver.trip_data_green;\n\n\n-- If you want to differentiate the parquet files into different folders, e.g., split by year and month\n-- Used Views instead of OPENROWSET function because Views have already partitioned columns in the 'create_bronze_views' files\n-- The example below is a manual way of creating multiple files/folders for the PARQUET file format\n/*\nIF OBJECT_ID('silver.trip_data_green_2020_01') IS NOT NULL\n    DROP EXTERNAL TABLE silver.trip_data_green_2020_01\nGO\n\nCREATE EXTERNAL TABLE silver.trip_data_green_2020_01\n    WITH \n    (\n        DATA_SOURCE = nyc_taxi_src,\n        LOCATION = 'silver/trip_data_green/year=2020/month=01',\n        FILE_FORMAT = parquet_file_format\n    )\nAS\nSELECT\n    *\nFROM\n    bronze.vw_trip_data_green_csv\nWHERE\n    year = '2020' AND month = '01';\n\nSELECT * FROM silver.trip_data_green_2020_01;\n*/\n\n\n-- The efficient way to do this is using Stored Procedure\nEXEC silver.usp_silver_trip_data_green '2020', '01';\nEXEC silver.usp_silver_trip_data_green '2020', '02';\nEXEC silver.usp_silver_trip_data_green '2020', '03';\nEXEC silver.usp_silver_trip_data_green '2020', '04';\nEXEC silver.usp_silver_trip_data_green '2020', '05';\nEXEC silver.usp_silver_trip_data_green '2020', '06';\nEXEC silver.usp_silver_trip_data_green '2020', '07';\nEXEC silver.usp_silver_trip_data_green '2020', '08';\nEXEC silver.usp_silver_trip_data_green '2020', '09';\nEXEC silver.usp_silver_trip_data_green '2020', '10';\nEXEC silver.usp_silver_trip_data_green '2020', '11';\nEXEC silver.usp_silver_trip_data_green '2020', '12';\nEXEC silver.usp_silver_trip_data_green '2021', '01';\nEXEC silver.usp_silver_trip_data_green '2021', '02';\nEXEC silver.usp_silver_trip_data_green '2021', '03';\nEXEC silver.usp_silver_trip_data_green '2021', '04';\nEXEC silver.usp_silver_trip_data_green '2021', '05';\nEXEC silver.usp_silver_trip_data_green '2021', '06';\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_ldw",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}